plugins {
    // Fabric Loom
    id "fabric-loom"

    // KotlinX Serialization
    id "org.jetbrains.kotlin.plugin.serialization"

    // Maven Publish
    id "maven-publish"

	// Kotlin
	id "org.jetbrains.kotlin.jvm"
}

group = projectGroup
version = projectVersion

loom {
    accessWidener = file("src/main/resources/hammer.accesswidener")
}

repositories {
    // Maven Central
    mavenCentral()

    // vini2003.dev
    maven {
        name = "vini2003.dev"
        url = "https://maven.pkg.github.com/vini2003/Maven"

        credentials {
			username = System.getenv("GPR_USERNAME")
			password = System.getenv("GPR_TOKEN")
        }
    }

	// LadySnake
	maven {
		name = "Ladysnake"
		url = "https://ladysnake.jfrog.io/artifactory/mods"
	}

	// Cafeteria
	maven {
		name = "Cafeteria"
		url = "https://maven.cafeteria.dev"
	}

    // Fabric
    maven {
		name = "FabricMC"
		url = "https://maven.fabricmc.net/"
	}
	
	// TerraformersMC
	maven {
		name = "TerraformersMC"
		url = "https://maven.terraformersmc.com/releases"
	}
}

dependencies {
    // Minecraft
    minecraft group: "com.mojang", name: "minecraft", version: minecraftVersion


    // Yarn
    mappings group: "net.fabricmc", name: "yarn", version: yarnVersion, classifier: "v2"


    // Fabric Loader
    modImplementation group: "net.fabricmc", name: "fabric-loader", version: fabricLoaderVersion


    // Fabric API
    modImplementation group: "net.fabricmc.fabric-api",  name: "fabric-api",  version: fabricApiVersion


    // Fabric Language Kotlin
    modImplementation group: "net.fabricmc", name: "fabric-language-kotlin", version: fabricLanguageKotlinVersion


    // KotlinX Serialization Json
    implementation group: "org.jetbrains.kotlinx", name: "kotlinx-serialization-json", version: kotlinxSerializationJsonVersion

	// KotlinX Serialization ProtoBuf
	implementation group: "org.jetbrains.kotlinx", name: "kotlinx-serialization-protobuf", version: kotlinxSerializationProtobufVersion

    // KotlinX Coroutines
    implementation group: "org.jetbrains.kotlinx", name: "kotlinx-coroutines-jdk8", version: kotlinxCoroutinesVersion

    // KotlinX DateTime
    implementation group: "org.jetbrains.kotlinx", name: "kotlinx-datetime", version: kotlinxDateTimeVersion


	// ModMenu
	modImplementation group: "com.terraformersmc", name: "modmenu", version: modMenuVersion


	// Cardinal Components API
	modImplementation group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-base", version: cardinalComponentsApiVersion
	include group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-base", version: cardinalComponentsApiVersion

	modImplementation group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-util", version: cardinalComponentsApiVersion
	include group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-util", version: cardinalComponentsApiVersion

	modImplementation group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-block", version: cardinalComponentsApiVersion
	include group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-block", version: cardinalComponentsApiVersion

	modImplementation group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-chunk", version: cardinalComponentsApiVersion
	include group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-chunk", version: cardinalComponentsApiVersion

	modImplementation group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-entity", version: cardinalComponentsApiVersion
	include group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-entity", version: cardinalComponentsApiVersion

	modImplementation group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-item", version: cardinalComponentsApiVersion
	include group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-item", version: cardinalComponentsApiVersion

	modImplementation group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-level", version: cardinalComponentsApiVersion
	include group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-level", version: cardinalComponentsApiVersion

	modImplementation group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-scoreboard", version: cardinalComponentsApiVersion
	include group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-scoreboard", version: cardinalComponentsApiVersion

	modImplementation group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-world", version: cardinalComponentsApiVersion
	include group: "io.github.onyxstudios.Cardinal-Components-API", name: "cardinal-components-world", version: cardinalComponentsApiVersion
}

compileKotlin {
	kotlinOptions {
		jvmTarget = "1.8"
	}
}

processResources {
	filesMatching("fabric.mod.json") {
		expand(
				id: projectId,
				name: projectName,
				version: projectVersion,
				description: projectDescription,
				minecraftVersion: minecraftVersion,
				kotlinVersion: kotlinVersion,
				fabricLoaderVersion: fabricLoaderVersion,
				fabricApiVersion: fabricApiVersion
		)
	}
}

task sourcesJar(type: Jar, dependsOn: classes) {
	classifier "sources"
	from sourceSets.main.allSource
}

publishing {
    publications {
        mavenJava(MavenPublication) {
		    artifactId = projectId
			groupId = projectGroup
			version = projectVersion

			artifact(remapJar) {
				builtBy remapJar
			}

			artifact(sourcesJar) {
				builtBy remapSourcesJar
			}
        }
    }

    repositories {
		maven {
		    name = "GitHubPackages"
		    url = "https://maven.pkg.github.com/vini2003/Maven"
    
		    credentials {
		        username = System.getenv("GPR_USERNAME")
		        password = System.getenv("GPR_TOKEN")
		    }
		}
    }
}